this code is a mess, please do not look at it
